"""
Power conversion efficiency graph for PV panel simulations.

Plots efficiency profiles comparing PV-PCM and conventional PV systems.
"""

# =============================================================================
# Imports
# =============================================================================
import matplotlib.pyplot as plt
import matplotlib.dates as mdates
from datetime import datetime

from powerdata import NoPCM, P1, P2, P3, P4, P5, P6, P7, M12, M13, M24, M26, M35, M36, M37


# =============================================================================
# Configuration
# =============================================================================
FONT_SIZE_LABELS = 36
FONT_SIZE_TICKS = 32
TIME_START = 150
TIME_END = 570
IRRADIANCE_FACTOR = 116
PANEL_AREA_FACTOR = 2


# =============================================================================
# Irradiance Data (W/m²)
# =============================================================================
G = [
    663.84, 699.07, 737.34, 776.42, 817.78, 862.19, 908.14, 956.40, 1007.71, 1059.02,
    1114.18, 1172.38, 1229.04, 1288.78, 1351.60, 1415.95, 1483.36, 1555.34, 1631.20, 1709.34,
    1791.28, 1874.03, 1959.81, 2047.09, 2137.47, 2229.41, 2324.38, 2421.66, 2520.43, 2622.32,
    2726.50, 2832.22, 2940.26, 3052.08, 3168.50, 3289.50, 3415.10, 3546.05, 3685.44, 3863.12,
    4058.42, 4280.51, 4461.23, 4682.56, 4893.15, 5126.00, 5369.52, 5598.51, 5819.09, 6035.84,
    6265.63, 6521.46, 6737.44, 6938.90, 7150.29, 7350.94, 7569.98, 7802.82, 8042.54, 8256.98,
    8505.89, 8721.14, 8966.96, 9199.06, 9492.38, 9749.70, 9987.12, 10231.44, 10471.17, 10717.79,
    10970.56, 11243.97, 11488.30, 11743.31, 11996.03, 12256.43, 12487.71, 12704.45, 12946.46, 13173.15,
    13386.11, 13595.97, 13808.11, 14014.11, 14222.46, 14430.02, 14634.48, 14842.83, 15048.08, 15258.67,
    15468.48, 15679.07, 15901.95, 16134.78, 16373.76, 16619.58, 16865.46, 17093.70, 17310.43, 17527.92,
    17757.66, 18012.74, 18286.18, 18559.57, 18839.87, 19126.27, 19414.22, 19704.46, 20005.44, 20308.72,
    20615.06, 20936.72, 21272.93, 21613.74, 21956.85, 22324.43, 22688.22, 23054.32, 23442.59, 23826.27,
    24230.64, 24651.84, 25068.45, 25527.22, 25995.12, 26496.77, 26994.56, 27489.30, 27991.74, 28518.66,
    29097.65, 29744.78, 30343.65, 30953.26, 31682.34, 32298.85, 32932.19, 33737.12, 34400.35, 35032.94,
    35663.25, 35974.22, 36642.83, 37139.89, 37302.27, 37390.35, 37463.90, 37547.39, 37641.58, 37740.42,
    37831.55, 37899.70, 38011.47, 38153.14, 38285.60, 38464.82, 38940.42, 39704.72, 40453.73, 41283.14,
    42075.78, 42918.98, 43744.58, 44637.54, 45457.76, 46265.73, 47098.98, 47931.42, 48770.77, 49553.47,
    50319.33, 51040.02, 51669.57, 52266.19, 52806.14, 53277.92, 53745.09, 54158.64, 54484.86, 54793.49,
    55059.98, 55293.57, 55509.57, 55715.62, 55910.86, 56152.10, 56454.62, 56808.42, 57256.45, 57777.23,
    58403.73, 59080.80, 59799.14, 60605.57, 61426.53, 61982.53, 62316.45, 62854.86, 63631.47, 64486.91,
    64885.17, 65572.88, 65886.86, 65985.65, 66040.75, 66098.96, 66148.72, 66263.60, 66467.31, 66651.12,
    66860.96, 67102.19, 67416.96, 67834.30, 68313.76, 68826.14, 69301.01, 69753.63, 70256.02, 70815.87,
    71377.26, 71961.63, 72339.97, 72797.95, 72990.98, 73018.51, 73099.71, 73090.53, 73077.49, 73000.14,
    72651.70, 72534.53, 72477.12, 72456.48, 72446.54, 72732.19, 73058.46, 73238.43, 73614.46, 74071.70,
    74506.69, 75169.92, 75427.25, 75860.74, 76602.85, 77386.29, 78100.82, 78748.75, 79319.30, 79810.19,
    80222.19, 80557.66, 80821.12, 81022.56, 81196.43, 81278.37, 81018.70, 80471.89, 79963.34, 79267.20,
    78819.17, 78409.41, 78060.96, 77708.66, 77426.80, 77203.97, 76948.16, 76669.41, 76360.78, 76040.66,
    75675.33, 75259.47, 74869.65, 74446.90, 74035.60, 73661.06, 73299.57, 72963.36, 72688.45, 72474.00,
    72281.74, 72148.48, 72016.72, 71924.05, 71867.39, 71806.14, 71693.57, 71525.09, 71248.62, 70904.77,
    70519.55, 70058.48, 69486.40, 68800.94, 68049.63, 67529.65, 67250.10, 66666.51, 65877.66, 64955.57,
    64539.71, 63794.54, 63380.24, 63198.72, 63016.46, 62770.64, 62599.12, 62335.65, 61917.49, 61519.23,
    61094.19, 60600.19, 60033.46, 59344.96, 58577.55, 57725.10, 56898.69, 56076.93, 55172.48, 54208.27,
    53214.93, 52180.22, 51354.66, 50443.30, 49761.68, 49197.28, 48570.77, 48024.70, 47470.19, 46961.66,
    46684.42, 46099.30, 45499.63, 44847.10, 44065.90, 43085.60, 42060.13, 41004.03, 39891.22, 38656.64,
    37422.08, 36249.57, 35169.68, 34042.34, 32950.22, 31868.10, 30860.22, 29923.60, 29062.02, 28279.33,
    27572.43, 26939.02, 26371.54, 25850.77, 25355.26, 24912.59, 24499.04, 24073.25, 23618.34, 23295.17,
    22726.93, 22105.82, 21411.17, 20666.75, 19863.38, 19047.70, 18255.81, 17476.93, 16724.86, 16033.31,
    15397.66, 14835.52, 14368.35, 13955.55, 13591.01, 13248.70, 12926.27, 12646.72, 12367.92, 12060.83,
    11786.67, 11488.74, 11202.35, 10891.42, 10553.66, 10172.29, 9783.22, 9393.39, 9018.86, 8632.08,
    8180.19, 7751.30, 7377.55, 7017.60, 6699.78, 6407.98, 6096.30, 5900.24, 5679.65, 5511.17,
    5279.09, 5058.54, 4860.19, 4644.24, 4463.50, 4334.10, 4134.19, 3956.53, 3831.73, 3704.62,
    3570.58, 3456.51, 3328.66, 3212.29, 3106.62, 3028.53, 2961.92, 2906.75, 2858.48, 2813.31,
]


# =============================================================================
# Main Execution
# =============================================================================
if __name__ == "__main__":
    # Generate time axis
    time_points = []
    for i in range(TIME_START, TIME_END):
        time = datetime(2022, 3, 1, i // 30, (i % 30) * 2)
        time_points.append(time)
    
    # Calculate efficiency: η = P / (G * A) * 100%
    eff1 = [P1[i] * 100 * IRRADIANCE_FACTOR / G[i] / PANEL_AREA_FACTOR for i in range(420)]
    eff2 = [NoPCM[i] * 100 * IRRADIANCE_FACTOR / G[i] / PANEL_AREA_FACTOR for i in range(420)]
    
    # Calculate efficiency differences
    dP1 = [(P1[i] - NoPCM[i]) * 100 * IRRADIANCE_FACTOR / G[i] / PANEL_AREA_FACTOR for i in range(420)]
    dP2 = [(P2[i] - NoPCM[i]) * 100 * IRRADIANCE_FACTOR / G[i] / PANEL_AREA_FACTOR for i in range(420)]
    dP3 = [(P3[i] - NoPCM[i]) * 100 * IRRADIANCE_FACTOR / G[i] / PANEL_AREA_FACTOR for i in range(420)]
    dP4 = [(P4[i] - NoPCM[i]) * 100 * IRRADIANCE_FACTOR / G[i] / PANEL_AREA_FACTOR for i in range(420)]
    dP5 = [(P5[i] - NoPCM[i]) * 100 * IRRADIANCE_FACTOR / G[i] / PANEL_AREA_FACTOR for i in range(420)]
    dP6 = [(P6[i] - NoPCM[i]) * 100 * IRRADIANCE_FACTOR / G[i] / PANEL_AREA_FACTOR for i in range(420)]
    dP7 = [(P7[i] - NoPCM[i]) * 100 * IRRADIANCE_FACTOR / G[i] / PANEL_AREA_FACTOR for i in range(420)]
    
    # Create plot
    fig, ax = plt.subplots()
    
    # Plot efficiency profiles
    ax.plot_date(time_points, eff1, 'k', xdate=True)
    ax.plot_date(time_points, eff2, 'k-.', xdate=True)
    
    # Labels and formatting
    ax.set_ylabel('Power Conversion Efficiency [%]', fontsize=FONT_SIZE_LABELS)
    ax.set_xlabel('Time', fontsize=FONT_SIZE_LABELS)
    ax.tick_params(axis='both', which='major', labelsize=FONT_SIZE_TICKS)
    
    # Time format
    ax.xaxis.set_major_formatter(mdates.DateFormatter('%H:%M'))
    
    # Limits and grid
    plt.ylim(12, 16)
    plt.grid(True, alpha=0.5)
    
    plt.show()
